pipeline {
    agent any

    buildName 'Declarative-pipeline-#${BUILD_NUMBER}'

    tools {
        def mvnHome = tool name: "Maven3.9.9", type 'maven'
    }
    
    environment {
        SONARQUBE_URL='URL'
        TOMCAT_IP='IP-here'
        TOMCAT_USERNAME='<username>'
        TOMCAT_PASSWORD='<password-here>'
        TOMCAT_PATH='<path-to-tomcat>'
    }

    stages {
        stage('Build') {
            steps {
                git 'https://github.com/satya954/mekafu-prime.git'
                
                sh "${mvnHome}/bin/mvn clean package -DskipTests"
            }
        }   
       stage('Sonarqube Analysis'){
            steps{
                withSonarQubeEnv('sonarqube-50') {
                 sh "${mvnHome}/bin/mvn sonar:sonar"
                }
            }
        }
        stage('Push to Nexus'){
            steps{
                sh '${mvnHome}/bin/mvn clean deploy -s /opt/apache-maven-3.9.9/conf/settings.xml'
            }
        }
        
        stage('Deploy to Tomcat'){
            steps{
                sh "sshpass -p'${TOMCAT_PASSWORD}'  scp target/*.war ${TOMCAT_USERNAME}@${TOMCAT_IP}:${TOMCAT_PATH}/webapps/"
            }
        }
        
    }
}

